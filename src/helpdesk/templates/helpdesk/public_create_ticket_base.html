{% load i18n bootstrap4form %}
{% load load_helpdesk_settings %}

{% with request|load_helpdesk_settings as helpdesk_settings %}
    {% if helpdesk_settings.HELPDESK_SUBMIT_A_TICKET_PUBLIC %}
        <div class="ticket-form-container">
            <div class="form-card">
                <div class="form-header">
                    <i class="fas fa-plus-circle mr-2"></i>{% trans "Submit a Ticket" %}
                </div>
                <div class="form-body">
                    <div class="form-intro">
                        <p>
                            {% trans "Unless otherwise stated, all fields are required." %}
                            {% trans "Please provide as descriptive a title and description as possible." %}
                        </p>
                    </div>
                    
                    {% if form.errors %}
                        {% include 'helpdesk/include/alert_form_errors.html' %}
                    {% endif %}
                    
                    <form role="form" method='post' enctype='multipart/form-data'>
                        {% csrf_token %}
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="id_queue" class="form-label">
                                        {% trans "Select Department for Query" %}{% if form.queue.field.required %} <span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.queue }}
                                    {% if form.queue.errors %}
                                        <div class="form-error">{{ form.queue.errors }}</div>
                                    {% endif %}
                                    {% if form.queue.help_text %}
                                        <small class="form-help">{{ form.queue.help_text }}</small>
                                    {% endif %}
                                </div>
                                
                                {% for field in form %}
                                    {% if field.name != 'queue' and field.name != 'assigned_to' %}
                                        <div class="form-group">
                                            <label for="id_{{ field.name }}" class="form-label">
                                                {% if field.name == 'title' %}{% trans "Subject" %}{% else %}{{ field.label }}{% endif %}{% if field.field.required %} <span class="text-danger">*</span>{% endif %}
                                            </label>
                                            {% if field.name == 'submitter_email' %}
                                                <input type="email" name="{{ field.name }}" value="{% if field.value %}{{ field.value }}{% endif %}" id="id_{{ field.name }}" class="form-control" readonly>
                                            {% else %}
                                                {{ field }}
                                            {% endif %}
                                            {% if field.errors %}
                                                <div class="form-error">{{ field.errors }}</div>
                                            {% endif %}
                                            {% if field.help_text %}
                                                <small class="form-help">{{ field.help_text }}</small>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button type="submit" class="submit-btn">
                                <i class="fas fa-paper-plane"></i> {% trans "Submit Ticket" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> {% trans "Public ticket submission is disabled. Please contact the administrator for assistance." %}
        </div>
    {% endif %}
{% endwith %}
