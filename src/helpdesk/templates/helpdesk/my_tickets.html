{% extends "helpdesk/public_base.html" %}{% load i18n %}

{% block helpdesk_body %}
<style>
    body {
        background-color: #f6f8fa;
        color: #333;
        font-family: 'Inter', sans-serif;
    }

    .content-container {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        margin: 1rem auto;
        overflow: hidden;
        max-width: 90%;
    }

    .content-body {
        padding: 2rem;
    }

    h2 {
        color: #183b6b;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        text-align: left;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        border: 1px solid #dee2e6;
        min-width: 600px !important;
    }
    
    /* Enhanced table responsive wrapper */
    .table-responsive {
        overflow-x: auto !important;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch !important;
        border: 1px solid #dee2e6 !important;
        border-radius: 6px !important;
        margin-bottom: 1rem !important;
    }
    
    /* Custom scrollbar styling for My Tickets */
    .table-responsive::-webkit-scrollbar {
        height: 12px;
        background-color: #f8f9fa;
    }
    
    .table-responsive::-webkit-scrollbar-thumb {
        background-color: #6c757d;
        border-radius: 6px;
        border: 2px solid #f8f9fa;
    }
    
    .table-responsive::-webkit-scrollbar-thumb:hover {
        background-color: #495057;
    }
    
    /* Mobile enhancements */
    @media (max-width: 768px) {
        .table-responsive {
            font-size: 0.875rem;
        }
        
        .table-responsive table {
            min-width: 500px !important;
        }
        
        .table-responsive th,
        .table-responsive td {
            padding: 0.5rem 0.75rem !important;
            white-space: nowrap;
        }
        
        /* Enhanced mobile scrollbar */
        .table-responsive::-webkit-scrollbar {
            height: 15px;
            background-color: #e9ecef;
        }
        
        .table-responsive::-webkit-scrollbar-thumb {
            background-color: #6c757d;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
    }

    th {
        background-color: #183b6b;
        color: #fff;
        font-weight: 500;
        text-align: left;
        padding: 0.75rem 1rem;
        border: 1px solid #0e2c57;
    }

    td {
        padding: 0.75rem 1rem;
        border: 1px solid #dee2e6;
        color: #333;
    }

    tr:nth-child(even) {
        background-color: #f2f6fc;
    }

    tr:hover {
        background-color: #f3eab9;
        color: #183b6b;
    }
    
    tr:hover a {
        color: #0066cc;
        text-decoration: underline;
    }

    a {
        color: #0066cc;
        text-decoration: underline;
    }

    a:hover {
        text-decoration: underline;
        color: #004080;
    }
    
    /* Special styling for ticket title links */
    #ticketsTable tbody a {
        color: #0066cc;
        text-decoration: underline;
        font-weight: 500;
    }
    
    #ticketsTable tbody a:hover {
        color: #004080;
    }

    .pagination {
        display: flex;
        justify-content: center;
        list-style: none;
        padding: 0;
        margin-top: 1rem;
    }

    .page-item {
        margin: 0 5px;
    }

    .page-link {
        color: #183b6b;
        background-color: #fff;
        border: 1px solid #183b6b;
        padding: 0.5rem 0.75rem;
        border-radius: 4px;
        text-decoration: none;
    }

    .page-link:hover {
        background-color: #ffd700;
        color: #183b6b;
    }

    .page-item.active .page-link {
        background-color: #183b6b;
        color: #fff;
        border-color: #183b6b;
    }

    /* Override breadcrumb styling */
    .breadcrumb {
        display: none;
    }

    /* Remove container-fluid padding */
    .container-fluid {
        padding: 0;
    }
    
    /* Create Ticket button styling */
    .ticket-header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .create-ticket-btn {
        background-color: #183b6b;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        transition: background-color 0.2s;
        text-decoration: none;
    }
    
    .create-ticket-btn:hover {
        background-color: #0e2c57;
        color: white;
        text-decoration: none;
    }
    
    .create-ticket-btn i {
        margin-right: 5px;
    }
    
    @media (max-width: 576px) {
        .ticket-header-container {
            flex-direction: column;
            align-items: flex-start;
        }
        
        h2 {
            margin-bottom: 1rem;
        }
        
        .create-ticket-btn {
            align-self: flex-end;
        }
    }
</style>

<div class="content-container">
    <div class="content-body">
        <div class="ticket-header-container" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="margin-bottom: 0;">{% trans "My Tickets" %}</h2>
            <a href="{% url 'helpdesk:submit' %}" class="create-ticket-btn" style="background-color: #183b6b; color: white; border: none; border-radius: 4px; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 600; display: inline-flex; align-items: center; transition: background-color 0.2s; text-decoration: none;">
                <i class="fas fa-plus-circle" style="margin-right: 5px;"></i> {% trans "Create Ticket" %}
            </a>
        </div>
        <div class="table-responsive">
            <table class="table" id="ticketsTable">
                <thead>
                    <tr>
                        <th>{% trans "Title" %}</th>
                        <th>{% trans "Queue" %}</th>
                        <th>{% trans "Status" %}</th>
                        <th>{% trans "Created" %}</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be added here dynamically using jQuery -->
                </tbody>
            </table>
        </div>
        <nav aria-label="{% trans 'Page navigation' %}">
            <ul class="pagination" id="pagination">
                <!-- Pagination buttons will be added here dynamically -->
            </ul>
        </nav>
    </div>
</div>

<script>
window.addEventListener('load', function() {
    function fetchTickets(page = 1) {
        const endpoint = '{% url "helpdesk:user_tickets-list" %}?page=' + page;

        $.get(endpoint, function(data) {
            $('#ticketsTable tbody').empty();
            data.results.forEach(function(ticket) {
                ticket.title = $('<div>').html(ticket.title).html();
                $('#ticketsTable tbody').append(`
                    <tr>
                        <td>
                            <a href='{% url "helpdesk:public_view" %}?ticket=${ticket.id}&email=${ticket.submitter}&key=${ticket.secret_key}'>${ticket.title}</a>
                        </td>
                        <td>${ticket.queue.title}</td>
                        <td>${ticket.status}</td>
                        <td>${ticket.created}</td>
                    </tr>
                `);
            });

            $('#pagination').empty();
            for (let i = 1; i <= data.total_pages; i++) {
                $('#pagination').append(`
                    <li class="page-item ${i === data.page ? 'active' : ''}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                    </li>
                `);
            }
        });
    }

    fetchTickets();

    // Event listener for pagination
    $(document).on('click', '.page-link', function(e) {
        e.preventDefault();
        fetchTickets($(this).data('page'));
    });
});
</script>

{% endblock %}
